{"componentChunkName":"component---src-templates-blog-post-js","path":"/定期的にファイルを削除する/","result":{"data":{"site":{"siteMetadata":{"title":"eginoy Blog"}},"markdownRemark":{"id":"77f903a5-0c53-58da-b658-7a46d640ef32","excerpt":"radcastで録音したファイルが溜まってきたので、cronを利用して一定期間経過したファイルを自動削除する。 ファイルの最終更新日が3週間（21日）より前のファイルを対象とする。   最終更新日が…","html":"<p>radcastで録音したファイルが溜まってきたので、cronを利用して一定期間経過したファイルを自動削除する。<br>\nファイルの最終更新日が3週間（21日）より前のファイルを対象とする。  </p>\n<h3>最終更新日が3週間より前のファイルを検索する</h3>\n<p>今回は対象を削除するので先に検索だけを行い、結果が想定したものになっているか確認しておく。<br>\n<code class=\"language-text\">$ find /home/ubuntu/radcast-docker/recorded -mtime 21</code></p>\n<h3>リストアップされた対象のファイルを削除する</h3>\n<p><code class=\"language-text\">$ find /home/ubuntu/radcast-docker/recorded -mtime 21 | xargs rm -rf</code></p>\n<h3>cronに登録して定期実行</h3>\n<p><code class=\"language-text\">crontab -e</code>を利用してジョブを登録する方法もあるが、<code class=\"language-text\">crontab -r</code>とのタイプミスが怖いので、\n<code class=\"language-text\">/etc/cron.d</code>配下に直接ファイルを配置してcronジョブを登録する。<br>\n<code class=\"language-text\">/etc/crontab</code>がテンプレートファイル？なのでこちらをコピーして利用する。<br>\n<code class=\"language-text\">$ sudo cp /etc/crontab /etc/cron.d/radcast-recorded-clean</code><br>\n以下を作成したファイルに書き込んで保存する。<br>\n<code class=\"language-text\">* 5 * * sun root find /home/ubuntu/radcast-docker/recorded -mtime +21 | xargs rm -rf</code><br>\n毎週日曜日の朝5時に最終更新日が3週間より前のファイルを削除している。  </p>\n<h3>cronログの有効化</h3>\n<p><code class=\"language-text\">$ sudo nano /etc/rsyslog.d/50-default.conf</code><br>\nコメントアウト解除（行頭の#を削除）<br>\n<code class=\"language-text\">#cron.* /var/log/cron.log</code></p>\n<h3>参考</h3>\n<ul>\n<li><a href=\"https://academy.gmocloud.com/lesson/20191213/8268\">findコマンド</a></li>\n<li><a href=\"https://qiita.com/UNILORN/items/a1a3f62409cdb4256219#3-source%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E9%9A%9Bbash%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84\">cron</a></li>\n<li><a href=\"http://cronbuilder.otchy.net/\">cronコマンド生成ツール</a></li>\n</ul>","frontmatter":{"title":"自動で定期的にファイルを削除する","date":"2021年06月13日","description":null}},"previous":{"fields":{"slug":"/radcastをDockerで動くようにした/"},"frontmatter":{"title":"radcastをDockerで動くようにした"}},"next":{"fields":{"slug":"/定型業務自動化で学んだこと/"},"frontmatter":{"title":"定型業務自動化で学んだこと"}}},"pageContext":{"id":"77f903a5-0c53-58da-b658-7a46d640ef32","previousPostId":"fdbf899e-c26a-5e82-bd30-a3aa278e0be0","nextPostId":"4bc118e5-f6a5-500a-950d-855825012622"}},"staticQueryHashes":["2841359383","3257411868"]}