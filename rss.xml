<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[eginoy Blog]]></title><description><![CDATA[日々の出来事やプログラミングについて書きます。]]></description><link>https://eginoy.github.io/blog</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 24 Jul 2021 09:14:06 GMT</lastBuildDate><item><title><![CDATA[定型業務自動化で学んだこと]]></title><description><![CDATA[要約 リポジトリ 自動化した作業の流れ Google Sheets APIを利用してデータ取得 取得したデータを元にメッセージを生成 生成したメッセージをIncomming Webhook宛に送信 上記の作業を平日1日1回定期的に実行 利用した技術 Google Sheets…]]></description><link>https://eginoy.github.io/blog/定型業務自動化で学んだこと/</link><guid isPermaLink="false">https://eginoy.github.io/blog/定型業務自動化で学んだこと/</guid><pubDate>Sat, 24 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;要約&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/eginoy/health-care-reminder&quot;&gt;リポジトリ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;自動化した作業の流れ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Google Sheets APIを利用してデータ取得&lt;/li&gt;
&lt;li&gt;取得したデータを元にメッセージを生成&lt;/li&gt;
&lt;li&gt;生成したメッセージをIncomming Webhook宛に送信&lt;/li&gt;
&lt;li&gt;上記の作業を平日1日1回定期的に実行&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;利用した技術&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Google Sheets API&lt;/li&gt;
&lt;li&gt;Node.js&lt;/li&gt;
&lt;li&gt;Docker&lt;/li&gt;
&lt;li&gt;Docker-Compose&lt;/li&gt;
&lt;li&gt;GitHub Actions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;新たに学べたこと&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Google Sheets APIを利用したデータの取得方法&lt;/li&gt;
&lt;li&gt;GitHub Actionsの利用方法&lt;/li&gt;
&lt;li&gt;GitHub ActionsでのDocker-Compose実行方法&lt;/li&gt;
&lt;li&gt;GitHub Actionsでのシークレットキーの扱い方&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;きっかけ&lt;/h2&gt;
&lt;p&gt;所属する会社ではコロナ禍が始まってから1日1回検温を行い&lt;a href=&quot;https://www.health-monitoring.net/&quot;&gt;健康監視ツール&lt;/a&gt;を利用して、Google Sheetsに記録をしている。&lt;br&gt;
健康監視を行う目的からして毎日漏れなく行うことが大切である。&lt;br&gt;
そのため、毎日終業時刻が近づくと未記録の人を確認してチャット上で記入催促を行う作業が発生した。  &lt;/p&gt;
&lt;p&gt;最初に未記入者チェックを行った先輩が、その後も毎日チェックを行うようになった。&lt;br&gt;
明示的に誰が毎日の未記入者チェックを行うのか決めなかったため、この先輩が休暇中の時も未記入者チェックを行うようになってしまった。&lt;br&gt;
たとえ5分とかからない作業であっても、休暇中に業務を行わなければならない状況を改善したかったため、自動化を行うことにした。&lt;br&gt;
(休暇中、代わりにチェックを行う人を明示的に決めるなどすれば良いが、そもそも人が手作業で行う必要が無いので。)&lt;/p&gt;
&lt;h2&gt;自動化作業でのポイント&lt;/h2&gt;
&lt;h3&gt;Node.jsでIncomming Webhookにメッセージ送信&lt;/h3&gt;
&lt;p&gt;受け取り側はMicrosoft Teams&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; axios &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; postData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;text&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; remindMessage&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
axios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;webhookURL&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;postData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://qiita.com/penta515/items/074b5c7694b9bcec1043&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;GitHub Actions のAction作成&lt;/h3&gt;
&lt;p&gt;作業フォルダに&lt;code class=&quot;language-text&quot;&gt;.github/workflows/action.yml&lt;/code&gt;を配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; run&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;reminder

&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;workflow_dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#これ書いとくと手動実行できるようになる。&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;cron&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;00 7 * * 1-5&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 平日16時(github actions実行時間がUTCなので9時間マイナスで日本時間になる。)&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;latest
    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/checkout@v2
    
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; run&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;compose
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;HEALTHCAREINPUT_BASEURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.HEALTHCAREINPUT_BASEURL&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;SPREADSHEET_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.SPREADSHEET_ID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;FORMDATASHEET_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.FORMDATASHEET_ID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;USERMASTERSHEET_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.USERMASTERSHEET_ID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;WEBHOOK_URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.WEBHOOK_URL&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;    
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;compose up &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;d &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;build
    
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; copy&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;google&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;spreadsheet&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;credentials
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;SPREADSHEET_SECRETS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.GOOGLE_SPREADSHEET_API_SECRETS&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo $SPREADSHEET_SECRETS &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; base64 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;decode &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ignore&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;garbage &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt; ./credentials.json
    
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; run&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;npm&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;install&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;on&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;compose exec &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;T reminder npm install
      
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; run&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;reminder
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;compose exec &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;T reminder node src/index.js

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; delete&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;credentials
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rm &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rf ./credentials.json

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; stop&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;containers
      &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always()
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;compose down&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;手動実行を可能にする&lt;/h4&gt;
&lt;p&gt;トリガーに&lt;code class=&quot;language-text&quot;&gt;workflow_dispatch:&lt;/code&gt;を指定することで、GitHub Actionsから手動実行が可能になる。&lt;br&gt;
&lt;a href=&quot;https://docs.github.com/ja/actions/managing-workflow-runs/manually-running-a-workflow&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;定期実行&lt;/h4&gt;
&lt;p&gt;トリガーに&lt;code class=&quot;language-text&quot;&gt;schedule:&lt;/code&gt;を指定し&lt;code class=&quot;language-text&quot;&gt;cron:&lt;/code&gt;で記述できる。&lt;br&gt;
実行時間の基準がUTCなので日本時間で指定する際には&lt;code class=&quot;language-text&quot;&gt;-9&lt;/code&gt;時間する。&lt;br&gt;
例では月曜から金曜日の16時に実行するように設定している。&lt;br&gt;
ただし、指定した時間ピッタリには実行されないので注意。(一度試したら、指定時間+9分後に実行開始した。)&lt;br&gt;
&lt;a href=&quot;https://matsuoshi.hatenablog.com/entry/2020/05/10/000000&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;the input device is not a TTYエラー&lt;/h4&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.126582278481013%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAABGvAAARrwH3/UuEAAAAPUlEQVQI143CwRGAMAgEwHQgMFxMODD6sP8WtQPd2cZxcN2ISzwUqaD2FPCz7dVc/JyVXO+Y1THcoJv9+QCCQwndYMptHAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;docker compose exec error&quot;
        title=&quot;docker compose exec error&quot;
        src=&quot;/static/7c95e8af24aecf1740abca93bdfbd408/f058b/docker-compose_exec_error.png&quot;
        srcset=&quot;/static/7c95e8af24aecf1740abca93bdfbd408/c26ae/docker-compose_exec_error.png 158w,
/static/7c95e8af24aecf1740abca93bdfbd408/6bdcf/docker-compose_exec_error.png 315w,
/static/7c95e8af24aecf1740abca93bdfbd408/f058b/docker-compose_exec_error.png 630w,
/static/7c95e8af24aecf1740abca93bdfbd408/40601/docker-compose_exec_error.png 945w,
/static/7c95e8af24aecf1740abca93bdfbd408/78612/docker-compose_exec_error.png 1260w,
/static/7c95e8af24aecf1740abca93bdfbd408/01ccc/docker-compose_exec_error.png 1399w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;code class=&quot;language-text&quot;&gt;docker-compose exec -T reminder node src/index.js&lt;/code&gt;&lt;br&gt;
のように&lt;code class=&quot;language-text&quot;&gt;exec&lt;/code&gt;コマンドに&lt;code class=&quot;language-text&quot;&gt;-T&lt;/code&gt;オプションをつける。&lt;br&gt;
&lt;a href=&quot;https://www.nullpo.io/2020/05/11/git-github-actions-docker-compose/&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;シークレットキーのjsonをAction内で扱う&lt;/h4&gt;
&lt;p&gt;APIキーなどが含まれたjsonはどうやって管理しているのか気になって検索していたらたどり着いた方法。&lt;br&gt;
今回調べた中で一番感心した。&lt;br&gt;
&lt;a href=&quot;https://www.notion.so/bfe5bcffba6f489f9c4a2fa29451917c#971c95a2a1864aa0bde022b2d16f9f5a&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;h5&gt;1. credentials.jsonをbase64文字列で取得&lt;/h5&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;credentials.json&lt;/code&gt;をAPIキーなどのシークレットキーを含んだjsonファイルとする。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;cat ./credentials.json | base64&lt;/code&gt;&lt;/p&gt;
&lt;h5&gt;2. &lt;code class=&quot;language-text&quot;&gt;1.&lt;/code&gt; で出力したbase64文字列をGitHub Secretsに登録&lt;/h5&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/004f0064cbe87830ccca6f6a84e623ba/0a344/githubactions_secrets_regist.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABGwAAARsAHIJ/VUAAABaUlEQVQoz1VS23aDMAzr67oCpZALEK7toFt36Xa2//80zTKwdg86SRxZke1s9nmJ1FQ42FrXeR+Q+QYHV+s+yUrYosLPZwPrPbaJRZRa7PYW8cFjn1fKiVKHzWNiQFEmksAgSUV9VPABnqPU4yHmXaHnJCuUa8sew/iGsn3CjoIUoVjoJhXmmWQS6n6S+CjrGc3wrOf2eIZvJpjqiFyq0Eokn+LMVUG64CWDq8OKQsMZpug0ich9i8xx30o7mgX1HHPNreRMgkVz+it5BR2TSIehF4fHFzSni65EEMdr7+e2uJtDW/U3Mbm8F084OD9g73pdFbJna+LDkrPwRVCGYoKU04FuCV4YLXHuDx+k2/8odLr3WEq2qNsWp3FCLv0yZScCAaY+wXZPiHKZfioJpp7LUwTtJ0E+f4Mr2nnK29hgHHtcXkdNIMmXAe8fJa7fAdcvwVVa4h228fz31p/B3ttqQC8/IFBQ4r8IfOUj0tc2lAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;githubactions secrets regist&quot;
        title=&quot;githubactions secrets regist&quot;
        src=&quot;/static/004f0064cbe87830ccca6f6a84e623ba/f058b/githubactions_secrets_regist.png&quot;
        srcset=&quot;/static/004f0064cbe87830ccca6f6a84e623ba/c26ae/githubactions_secrets_regist.png 158w,
/static/004f0064cbe87830ccca6f6a84e623ba/6bdcf/githubactions_secrets_regist.png 315w,
/static/004f0064cbe87830ccca6f6a84e623ba/f058b/githubactions_secrets_regist.png 630w,
/static/004f0064cbe87830ccca6f6a84e623ba/40601/githubactions_secrets_regist.png 945w,
/static/004f0064cbe87830ccca6f6a84e623ba/78612/githubactions_secrets_regist.png 1260w,
/static/004f0064cbe87830ccca6f6a84e623ba/0a344/githubactions_secrets_regist.png 1741w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h5&gt;3. &lt;code class=&quot;language-text&quot;&gt;2.&lt;/code&gt; で登録したSecretsを環境変数として読み込みjsonファイルとして書き出す。&lt;/h5&gt;
&lt;p&gt;base64文字列をデコードしてjsonファイルへ書き出す。&lt;br&gt;
action内では以下の箇所で行っている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;   &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; copy&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;google&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;spreadsheet&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;credentials
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;SPREADSHEET_SECRETS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;secrets.GOOGLE_SPREADSHEET_API_SECRETS&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo $SPREADSHEET_SECRETS &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; base64 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;decode &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ignore&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;garbage &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt; ./credentials.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;所感など&lt;/h3&gt;
&lt;p&gt;GitHub Actionsは聞いたことがある程度で具体的に何ができるのか、何をするものなのかを知らなかった。&lt;br&gt;
今回のように定期的に軽い処理を実行したい場合など十分無料枠で足りるので、幅広い用途に利用でき便利だと思った。  &lt;/p&gt;
&lt;p class=&apos;diamond&apos;&gt;&amp;#9830;&lt;/p&gt;
&lt;p&gt;今回の自動化の処理部分を書くのに当たり、以前O’ReillyのTypeScript本を写経してから、一度もTypeScriptを利用していないことを思い出した。&lt;br&gt;
せっかくなので今回はJavaScriptではなく、TypeScriptで書こうとしたが環境構築につまずいてしまい、結局JavaScriptで書いてしまった。&lt;br&gt;
こういった機会が無いと業務で扱わない技術を利用することがないので、リファクタリングも兼ねてTypeScriptに書き直そうと思う。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[自動で定期的にファイルを削除する]]></title><description><![CDATA[radcastで録音したファイルが溜まってきたので、cronを利用して一定期間経過したファイルを自動削除する。 ファイルの最終更新日が3週間（21日）より前のファイルを対象とする。   最終更新日が…]]></description><link>https://eginoy.github.io/blog/定期的にファイルを削除する/</link><guid isPermaLink="false">https://eginoy.github.io/blog/定期的にファイルを削除する/</guid><pubDate>Sun, 13 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;radcastで録音したファイルが溜まってきたので、cronを利用して一定期間経過したファイルを自動削除する。&lt;br&gt;
ファイルの最終更新日が3週間（21日）より前のファイルを対象とする。  &lt;/p&gt;
&lt;h3&gt;最終更新日が3週間より前のファイルを検索する&lt;/h3&gt;
&lt;p&gt;今回は対象を削除するので先に検索だけを行い、結果が想定したものになっているか確認しておく。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ find /home/ubuntu/radcast-docker/recorded -mtime 21&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;リストアップされた対象のファイルを削除する&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ find /home/ubuntu/radcast-docker/recorded -mtime 21 | xargs rm -rf&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;cronに登録して定期実行&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;crontab -e&lt;/code&gt;を利用してジョブを登録する方法もあるが、&lt;code class=&quot;language-text&quot;&gt;crontab -r&lt;/code&gt;とのタイプミスが怖いので、
&lt;code class=&quot;language-text&quot;&gt;/etc/cron.d&lt;/code&gt;配下に直接ファイルを配置してcronジョブを登録する。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;/etc/crontab&lt;/code&gt;がテンプレートファイル？なのでこちらをコピーして利用する。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ sudo cp /etc/crontab /etc/cron.d/radcast-recorded-clean&lt;/code&gt;&lt;br&gt;
以下を作成したファイルに書き込んで保存する。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;* 5 * * sun root find /home/ubuntu/radcast-docker/recorded -mtime +21 | xargs rm -rf&lt;/code&gt;&lt;br&gt;
毎週日曜日の朝5時に最終更新日が3週間より前のファイルを削除している。  &lt;/p&gt;
&lt;h3&gt;cronログの有効化&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ sudo nano /etc/rsyslog.d/50-default.conf&lt;/code&gt;&lt;br&gt;
コメントアウト解除（行頭の#を削除）&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;#cron.* /var/log/cron.log&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://academy.gmocloud.com/lesson/20191213/8268&quot;&gt;findコマンド&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://qiita.com/UNILORN/items/a1a3f62409cdb4256219#3-source%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E9%9A%9Bbash%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84&quot;&gt;cron&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cronbuilder.otchy.net/&quot;&gt;cronコマンド生成ツール&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[radcastをDockerで動くようにした]]></title><description><![CDATA[作ったもの https://github.com/eginoy/radcast-docker 動機 radikoのタイムフリーは再生開始から2…]]></description><link>https://eginoy.github.io/blog/radcastをDockerで動くようにした/</link><guid isPermaLink="false">https://eginoy.github.io/blog/radcastをDockerで動くようにした/</guid><pubDate>Sun, 02 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;作ったもの&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/eginoy/radcast-docker&quot;&gt;https://github.com/eginoy/radcast-docker&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;動機&lt;/h3&gt;
&lt;p&gt;radikoのタイムフリーは再生開始から24時間という、聴取期限が切られている。&lt;br&gt;
自分は家事を始めるタイミングでタイムフリーを聴くことが多い。&lt;br&gt;
聴くものは深夜ラジオがほとんどなので（長さが1、2時間）、ラジオを聴き終える前に家事が先に終了してしまう。&lt;br&gt;
次に家事を始めるタイミングであらためて続きを聴き始める、といったことをしたいのだが、冒頭に書いた聴取期限があるので日をまたいで聴くことができない。&lt;br&gt;
そこで、&lt;a href=&quot;https://github.com/omiso46/radcast&quot;&gt;radcast&lt;/a&gt;というradikoを録音するOSSを見つけたのでこちらを利用することにした。  &lt;/p&gt;
&lt;h4&gt;なぜDockerを利用したか&lt;/h4&gt;
&lt;p&gt;以前から興味があり、はてブのホッテントリに上がってくるDocker,Docker Composeの入門記事をハンズオン形式で進めていた。&lt;br&gt;
しかし、業務でDockerを扱う機会がないので、チュートリアルを終えた後にすることがなく困っていた。&lt;br&gt;
今回の環境構築は良い機会だと考え、Docker上でradcastを動かすことにした。&lt;/p&gt;
&lt;h3&gt;Dockerファイルを書いてみて学べた、つまずいた箇所&lt;/h3&gt;
&lt;h4&gt;alpineイメージでタイムゾーンがJSTにならない&lt;/h4&gt;
&lt;p&gt;radcastはcronで録音スケジュール管理をしているので、コンテナ内のタイムゾーンをJSTにしておきたかった。&lt;br&gt;
Dockerファイル、Docker Composeファイルでタイムゾーン環境変数を指定するだけではJSTにならなかった。（&lt;code class=&quot;language-text&quot;&gt;date&lt;/code&gt;コマンドで確認）&lt;br&gt;
こちらは既知の問題だったため、すぐに解決できた。※&lt;a href=&quot;https://www.collelog.jp/technical-howto/alpine-linux-timezone-setting&quot;&gt;参考&lt;/a&gt;  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; golang&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;alpine
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; mkdir /home/radcast
&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /home/radcast

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apk update  &amp;amp;&amp;amp; apk add ffmpeg git tzdata &amp;amp;&amp;amp;\
cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime &amp;amp;&amp;amp; apk del tzdata &amp;amp;&amp;amp; \
go get github.com/omiso46/radcast &amp;amp;&amp;amp; \
mkdir recorded  

&lt;span class=&quot;token keyword&quot;&gt;CMD&lt;/span&gt; chmod +x config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;create.sh &amp;amp;&amp;amp; ./config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;create.sh &amp;amp;&amp;amp; \
radcast &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;config ./config.json &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;host 0.0.0.0 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;output ./recorded &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;port 3355
&lt;span class=&quot;token keyword&quot;&gt;EXPOSE&lt;/span&gt; 3355&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;alpineのデフォルトシェルはash&lt;/h4&gt;
&lt;p&gt;radcastの録音スケジュールファイルが存在しない場合に、設定ファイルを自動生成するシェルスクリプトを書いた。&lt;br&gt;
このシェルスクリプトの先頭行（shebangと呼ぶらしい）に&lt;code class=&quot;language-text&quot;&gt;#!/bin/bash&lt;/code&gt;と書いてしまった。  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/ash&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#↑ここを /bin/bashにしてしまった。&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;FILE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;config.json&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; -e &lt;span class=&quot;token variable&quot;&gt;$FILE&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    radcast --setup &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; config.json
    &lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;777&lt;/span&gt; config.json
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;処理部分の構文に問題があると勘違いしてしまい、解決に時間がかかった。&lt;br&gt;
alpineのデフォルトシェルがashだということは知らなかったので、この問題に当たったことで学べたのは良かった。&lt;/p&gt;
&lt;h3&gt;Docker Composeファイルを書いてみて学べた箇所&lt;/h3&gt;
&lt;h4&gt;コンテナの自動起動はDocker Composeが面倒を見てくれる&lt;/h4&gt;
&lt;p&gt;radcastの利用目的を考えると、システム起動時に自動起動して欲しい。&lt;br&gt;
docker-composeファイルに&lt;code class=&quot;language-text&quot;&gt;restart&lt;/code&gt;を指定するとコンテナを自動起動してくれる。
コンテナの停止と起動（再起動）をコマンド一発で行えないかと検索していたら、たまたま見つけることができた。※&lt;a href=&quot;https://junchang1031.hatenablog.com/entry/2016/05/18/000605&quot;&gt;参考&lt;/a&gt;&lt;br&gt;
ちなみにコンテナの再起動は&lt;code class=&quot;language-text&quot;&gt;$ docker-compose restart&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3.2&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
    &lt;span class=&quot;token key atrule&quot;&gt;radcast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .
        &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/home/radcast
        &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3355:3355&quot;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;tty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; unless&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;stopped&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;所感&lt;/h3&gt;
&lt;p&gt;Docker,Docker Composeはチュートリアルをこなすばかりで、自身の課題を解決するために各設定ファイルを1から書いたのは今回がはじめてだった。&lt;br&gt;
現在運用しているRaspberryPi4が故障しても、Dockerが利用できる環境へGitHubからリポジトリを落としてくるだけで環境を構築できるのは非常に良いと思った。&lt;br&gt;
コマンド一発で環境構築できるのは気持ちが良いし、楽しい。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[tailscaleを利用して外出先でも広告ブロック]]></title><description><![CDATA[外出先でも広告ブロックがしたい 前回の記事では、Pi-holeを利用して広告ブロックDNSサーバーを立てた。 自宅Wi-Fiネットワーク接続時、DNSサーバーをPi-hole…]]></description><link>https://eginoy.github.io/blog/tailscaleを利用して外出先でも広告ブロック/</link><guid isPermaLink="false">https://eginoy.github.io/blog/tailscaleを利用して外出先でも広告ブロック/</guid><pubDate>Wed, 28 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;外出先でも広告ブロックがしたい&lt;/h3&gt;
&lt;p&gt;前回の&lt;a href=&quot;http://eginoy.com/pihole%E3%81%A7%E5%BA%83%E5%91%8A%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF/&quot;&gt;記事&lt;/a&gt;では、Pi-holeを利用して広告ブロックDNSサーバーを立てた。&lt;br&gt;
自宅Wi-Fiネットワーク接続時、DNSサーバーをPi-holeに指定することで広告除去ができるようになった。&lt;br&gt;
しかし、外出先ではモバイネットワークを利用するため、上記の方法で広告ブロックができない。&lt;br&gt;
外出先からでも広告ブロックが実現できるように、クラウド型VPNサービスの&lt;a href=&quot;https://tailscale.com/&quot;&gt;tailscale&lt;/a&gt;を利用する。&lt;/p&gt;
&lt;h3&gt;tailscaleのインストールと設定&lt;/h3&gt;
&lt;h4&gt;サインアップ&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://tailscale.com/&quot;&gt;tailscale&lt;/a&gt;にサインアップしておく。&lt;br&gt;
(Google、Microsoftアカウントでのサインアップができるので便利。)&lt;/p&gt;
&lt;h4&gt;インストール&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://tailscale.com/download/linux&quot;&gt;公式のセットアップ手順&lt;/a&gt;通りに、Pi-holeを構築しているLinuxマシン上で作業を行う。  &lt;/p&gt;
&lt;p&gt;環境&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Raspberry Pi4 4GB&lt;/li&gt;
&lt;li&gt;Ubuntu 20.04.1 LTS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;repositoryを登録  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/focal.gpg | sudo apt-key add -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/focal.list | sudo tee /etc/apt/sources.list.d/tailscale.list&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;tailscaleのインストール  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;sudo apt-get update&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;sudo apt-get install tailscale&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;tailscaleにログイン&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;sudo tailscale up&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;表示されたリンクにアクセスしてログインする。&lt;/p&gt;
&lt;p&gt;tailscaleから割り当てられたIPアドレスの確認&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;ip addr show tailscale0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;クライアントにもアプリをインストールして、ログインしておく。&lt;/p&gt;
&lt;h3&gt;tailscaleのNameServersにPi-holeのアドレス指定&lt;/h3&gt;
&lt;p&gt;tailscaleのDNS設定画面で、NameServersにPi-holeのアドレスを指定する。&lt;br&gt;
（100から始まるtailscale上のアドレスなので注意）&lt;br&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b85835161bd08cd758da659af07a041f/7fee5/tailscale-dns.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABBNAAAQTQFnjAHgAAACXklEQVQ4y51UyY7UMBDNZ/ItiAsXjlwZiQsXrnwLQw+otyFJZ+kli7M7djp+VLkXekY9rQFLT1V+SmovO3EYIPQ9bOIIpcixXcdgTmQZku2G+BBFnlmev1lHIbbhCun9L/g/XaSTGTLPxWazRlOVcNqmhuxaVGWBrm1QE1kWAsyzznxb15ZjvSTU5KBYeAg3JQo/RhPHKOsKPdlxfIpuPl/AGPzbKUoYUcBkOTAMZ9qJwhC+758NsjBmJJjbuLB9+Ic5A0dKia7rIMhj36Qwun5VgNccsHR+L+d4mHzH4+MSG+8eaTSlbCrkeU71KiGEQFFQ3biO1YHnIE5Gnx9nnUq4UQ0/rvEY1PDiBm0n0fc9lFJWnnV7l1Sy4WWDd98CvLtb4MMXF+8/L/Hxq4u2H1+V8rXjiKLCLhFICLukQJJLVLVCJweY8eWm4BrHBvV+gN5rqIHS0YTBoFUGejx27wauRe2YlOYo53kSVlK7/4Lv+QWfF090/seCbBj+jiP0Jw9YTKdwZzPEno89dXCgphxkZ6VuO6imIdmSbI96B2gNoxgKZpvYqJ1wsYS7WmEVhAjCGD7p/spHEEV0D+2dpaDV47ERNEIZjU5VN+ehtjI7RqhooNV+j15W0KqyY9H1GpJHhSJoKUp9sVp4viEn0AraGoKXvVJQy0/AjzfA7C0gM9pP6gqlQtZIUlrkwPTqKdQRrG93h5RlvEa1ClB7CzTuBCqcYkwTjJTCeCo6I78Bjo4fCjbY0JOTZCl2aYZUlHZc/vtwyvy+8b4KKnRGnjIhLQoqg9b7qwN86wX6A1XgbxcrmGL9AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tailscale-dns&quot;
        title=&quot;tailscale-dns&quot;
        src=&quot;/static/b85835161bd08cd758da659af07a041f/f058b/tailscale-dns.png&quot;
        srcset=&quot;/static/b85835161bd08cd758da659af07a041f/c26ae/tailscale-dns.png 158w,
/static/b85835161bd08cd758da659af07a041f/6bdcf/tailscale-dns.png 315w,
/static/b85835161bd08cd758da659af07a041f/f058b/tailscale-dns.png 630w,
/static/b85835161bd08cd758da659af07a041f/7fee5/tailscale-dns.png 781w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;br&gt;
tailscaleに接続しているクライアント（モバイネットワークなどから）で広告ブロックできていることが確認できれば成功。&lt;/p&gt;
&lt;h3&gt;所感&lt;/h3&gt;
&lt;p&gt;広告はWebサイト、スマートフォンアプリ運営費の収益源だったりするので必要なのは理解している。&lt;br&gt;
しかし、表示される広告は不愉快なもの（鼻の角栓画像、胸糞漫画、コンプレックスを煽るものなど）が多いので基本的にブロックするようになった。&lt;br&gt;
今回の作業で、外出先でも快適にスマートフォンを利用できるようになったので良かった。（まあ、全然外出しないが）&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Pi-holeで広告ブロック]]></title><description><![CDATA[アプリ内ブラウザでの広告が目障り PCではブラウザ拡張のAdBlockなどを使用しているので広告除去ができている。 しかし、スマートフォンのアプリ内ブラウザでは上記の方法で広告除去ができない。 Pi-holeというOSSでDNSサーバーを自前で立てて、スマートフォン側でDNS…]]></description><link>https://eginoy.github.io/blog/piholeで広告ブロック/</link><guid isPermaLink="false">https://eginoy.github.io/blog/piholeで広告ブロック/</guid><pubDate>Sat, 24 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;アプリ内ブラウザでの広告が目障り&lt;/h3&gt;
&lt;p&gt;PCではブラウザ拡張のAdBlockなどを使用しているので広告除去ができている。&lt;br&gt;
しかし、スマートフォンのアプリ内ブラウザでは上記の方法で広告除去ができない。&lt;br&gt;
&lt;a href=&quot;https://github.com/pi-hole/docker-pi-hole&quot;&gt;Pi-holeというOSS&lt;/a&gt;でDNSサーバーを自前で立てて、スマートフォン側でDNSサーバーにPi-holeを指定することで、広告除去ができるようなので設定を行った。&lt;br&gt;
すでに録画サーバーをRaspiberry pi4で運用しているので、こちらにPi-holeをインストールすることにした。&lt;br&gt;
運用中の環境を汚したくないため、公式のdocker-composeファイルを利用してDNSサーバーを立てる。&lt;/p&gt;
&lt;h3&gt;環境&lt;/h3&gt;
&lt;p&gt;DNSサーバー&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Raspberry Pi4 4GB&lt;/li&gt;
&lt;li&gt;Ubuntu 20.04.1 LTS&lt;/li&gt;
&lt;li&gt;Docker version 19.03.8&lt;/li&gt;
&lt;li&gt;docker-compose version 1.27.4&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Pi-holeのセットアップ&lt;/h3&gt;
&lt;p&gt;基本的には&lt;a href=&quot;https://github.com/pi-hole/docker-pi-hole&quot;&gt;公式のドキュメント&lt;/a&gt;からdocker-composeファイルをコピペして動かすだけ。  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;pihole&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pihole
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pihole/pihole&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;53:53/tcp&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;53:53/udp&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;67:67/udp&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;80:80/tcp&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;TZ&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;America/Chicago&apos;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# WEBPASSWORD: &apos;set a secure password here or it will be random&apos;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Volumes store your data between container upgrades&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./etc-pihole/:/etc/pihole/&apos;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./etc-DNSmasq.d/:/etc/DNSmasq.d/&apos;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Recommended but not required (DHCP needs NET_ADMIN)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;#   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;cap_add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; NET_ADMIN
    &lt;span class=&quot;token key atrule&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; unless&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;stopped&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;しかし、Ubuntu 17.10以降で利用する場合、デフォルトで有効になっているDNS resolverがPi-holeで使用する53ポートを既に使用しているため、コンテナを立ち上げる際にエラーが発生する。&lt;br&gt;
以下のコマンドでPi-holeが53ポートを使用できるようにする。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;sudo sed -r -i.orig &amp;#39;s/#?DNSStubListener=yes/DNSStubListener=no/g&amp;#39; /etc/systemd/resolved.conf&lt;/code&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;sudo sh -c &amp;#39;rm /etc/resolv.conf &amp;amp;&amp;amp; ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf&lt;/code&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;systemctl restart systemd-resolved&lt;/code&gt;  &lt;/p&gt;
&lt;p&gt;コンテナの起動&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;docker-compose up -d&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;クライアントからDNSサーバーを指定する際に、ipアドレスが必要なので確認しておく。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;hostname -I&lt;/code&gt;  &lt;/p&gt;
&lt;h3&gt;クライアントの設定&lt;/h3&gt;
&lt;p&gt;スマートフォン(iPhone SE2)の設定は以下の手順で行った。&lt;br&gt;
DNSサーバーのアドレスは&lt;code class=&quot;language-text&quot;&gt;192.168.0.10&lt;/code&gt;とする。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;設定&lt;/li&gt;
&lt;li&gt;Wi-Fi&lt;/li&gt;
&lt;li&gt;接続しているアクセスポイントのiマークをタップ&lt;/li&gt;
&lt;li&gt;画面下部のDNSを構成&lt;/li&gt;
&lt;li&gt;手動にチェックを入れる&lt;/li&gt;
&lt;li&gt;すでに設定されているDNSサーバーをすべて削除&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;192.168.0.10&lt;/code&gt;を入力して保存&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;設定前&lt;br&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6cf486f6a81c52bd627dce555f78a729/acb04/before.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 177.8481012658228%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGgABAAIDAQAAAAAAAAAAAAAAAAIDAQQFBv/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAZy6GLnluwCqvYxncUjPNgVAc//EAB0QAAICAwADAAAAAAAAAAAAAAACAQMREhMEFCL/2gAIAQEAAQUCXxq2PUU4VGxsQ2Rpga3C12bxsrGVOlSi32Ks2vlvuf/EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AWv/xAAXEQADAQAAAAAAAAAAAAAAAAAAESAh/9oACAECAQE/AUZP/8QAHxAAAgICAQUAAAAAAAAAAAAAAAECESEyMxIxQYGR/9oACAEBAAY/AsTb9GzOWXw0ONmjHZaLRayeDMoo6VLB3Llln//EACAQAQACAgEEAwAAAAAAAAAAAAEAESExURBBgaGR0fH/2gAIAQEAAT8hsPPwjn0nRzV29S/4fcqZD4ljFuY6Kus1LHSNahpJ5AZ22ngmovwoQesJQVFWbY4jewFT/9oADAMBAAIAAwAAABAM4LGL3//EABoRAAICAwAAAAAAAAAAAAAAAAABEBEhMVH/2gAIAQMBAT8QsyMpw20nH//EABsRAAICAwEAAAAAAAAAAAAAAAABEaEQQVHR/9oACAECAQE/EGulZHNrzCIRB//EAB8QAQACAQQDAQAAAAAAAAAAAAEAESExQVGRYXGh8f/aAAgBAQABPxCgAFWhjshYgrBJNpJMVs+S9C8dP1M28a4g9uU4y+yzIohvi4oMoJoo5ZhwtC0ut/UuRvZId7xBp5hhQNaMk81ME5RNHUNGabscQ2+BbTB6n//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;設定前&quot;
        title=&quot;設定前&quot;
        src=&quot;/static/6cf486f6a81c52bd627dce555f78a729/828fb/before.jpg&quot;
        srcset=&quot;/static/6cf486f6a81c52bd627dce555f78a729/ff44c/before.jpg 158w,
/static/6cf486f6a81c52bd627dce555f78a729/a6688/before.jpg 315w,
/static/6cf486f6a81c52bd627dce555f78a729/828fb/before.jpg 630w,
/static/6cf486f6a81c52bd627dce555f78a729/acb04/before.jpg 750w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;  &lt;/p&gt;
&lt;p&gt;設定後
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ce47549d903a404be0e80537e8f5eb06/acb04/after.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 177.8481012658228%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAECBQMG/8QAFwEBAQEBAAAAAAAAAAAAAAAAAQACA//aAAwDAQACEAMQAAABvbQjectsKtekc99EE8vIgR//xAAdEAABBAMBAQAAAAAAAAAAAAAAAQIDEhARFAQT/9oACAEBAAEFAm+aNxyNPhEWLCO2URSqY3jZ0SnRKdMx/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEg/9oACAEDAQE/AYY//8QAFxEAAwEAAAAAAAAAAAAAAAAAABEgIf/aAAgBAgEBPwFGT//EAB0QAAIBBAMAAAAAAAAAAAAAAAAyAQIgITMxgZH/2gAIAQEABj8CxXM9DSbavBDXIkmTi1xxz//EACEQAAICAAUFAAAAAAAAAAAAAAERACEQMUGRoWFxgdHx/9oACAEBAAE/IWHn4Ib4Rg4qc3Ef4e4pYNpbINzooIQdOXq94iswvbPsIsixrWIGfYT/2gAMAwEAAgADAAAAEAztw3Pf/8QAGREAAwEBAQAAAAAAAAAAAAAAAAERIRBR/9oACAEDAQE/EKbxp+FVaVn/xAAcEQABAwUAAAAAAAAAAAAAAAABEBGhACFBUdH/2gAIAQIBAT8QI4E02sjitZP/xAAhEAEAAgEDBAMAAAAAAAAAAAABABEhMUFRYYGRocHw8f/aAAgBAQABPxCgAFWhjyQsQVgkm0kmK2epeheOn6nYtcQe3KcZe5hOtRbibgDyFMrVGg0JvHPKmFMV3hbh4bQMAD1KibuuA+IsE1GgUwIAftxP/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;設定後&quot;
        title=&quot;設定後&quot;
        src=&quot;/static/ce47549d903a404be0e80537e8f5eb06/828fb/after.jpg&quot;
        srcset=&quot;/static/ce47549d903a404be0e80537e8f5eb06/ff44c/after.jpg 158w,
/static/ce47549d903a404be0e80537e8f5eb06/a6688/after.jpg 315w,
/static/ce47549d903a404be0e80537e8f5eb06/828fb/after.jpg 630w,
/static/ce47549d903a404be0e80537e8f5eb06/acb04/after.jpg 750w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;  &lt;/p&gt;
&lt;h3&gt;所感&lt;/h3&gt;
&lt;p&gt;これで自宅Wi-Fiに接続していれば、スマートフォンのアプリ内ブラウザでも広告除去ができるようになった。&lt;br&gt;
しかし、外出先で閲覧した際には広告除去ができない。&lt;br&gt;
&lt;a href=&quot;https://tailscale.com/&quot;&gt;tailscale&lt;/a&gt;などを利用して外出先から自宅ネットワークに接続し、広告除去できるようにしたい。  &lt;/p&gt;</content:encoded></item><item><title><![CDATA[大学生になった]]></title><description><![CDATA[…]]></description><link>https://eginoy.github.io/blog/大学生になった/</link><guid isPermaLink="false">https://eginoy.github.io/blog/大学生になった/</guid><pubDate>Wed, 21 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今年度から東京通信大学の情報マネジメント学部に入学した。  &lt;/p&gt;
&lt;h3&gt;なぜ大学に入ったのか&lt;/h3&gt;
&lt;p&gt;最終学歴が高卒なので、学歴コンプレックスを解消しておきたかった。&lt;br&gt;
理由としてはこれがすべてで、とくに高尚な理由はない。  &lt;/p&gt;
&lt;h3&gt;なぜ東京通信大学&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;学費が安いこと&lt;/li&gt;
&lt;li&gt;通学しなくて良いこと&lt;/li&gt;
&lt;li&gt;情報系の学部があること&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;以上の3点が外せない条件だった。&lt;br&gt;
色々調べたところ、学費が安いという条件の時点で東京通信大学一択になってしまったが、他の条件も満たしていたのでここに決めた。&lt;br&gt;
授業開始から3週間弱経過したが、小テストは配布資料を見てもいいので、授業は流し見でも満点が取れる。&lt;br&gt;
力の抜き加減がわからないので、早く単位認定試験を受けてみたい。&lt;br&gt;
（単位認定試験を受けてみるまでは危機感が生まれないので力が入らない）&lt;/p&gt;
&lt;p class=&apos;diamond&apos;&gt;&amp;#9830;&lt;/p&gt;
&lt;p&gt;せっかく憧れ（!）の大学生になったので、利用している定額課金サービスで学割が使えるものを調べた。  &lt;/p&gt;
&lt;h3&gt;Amazon Prime&lt;/h3&gt;
&lt;p&gt;年間4900円→年間2450円になり、さらに紙の書籍を購入すると10%ポイント還元されるようになった。
技術書などは紙で買うことが多いのでこの特典は嬉しい。&lt;/p&gt;
&lt;h3&gt;Amazon Music UnlimitedからApple Musicへ&lt;/h3&gt;
&lt;p&gt;プライム会員価格780円（一年契約で月額650円）→月額480円になる。&lt;br&gt;
他の音楽配信サブスクの学生プランがどうなっているのかが気になり調べたところ、どれも月額480円だった。&lt;br&gt;
通常プランの価格では、Amazon Music Unlimitedがプライム会員の場合に780円と一番安かったので契約していたが、学生プランではどれも横並びのためApple Musicを契約することにした。&lt;br&gt;
（Amazon Music Unlimitedは、アーティストでの全曲シャッフル再生ができなかったり、ステーション機能が正常に使用できたことがないなど、安いからと目をつぶっていた部分が多かった。）&lt;/p&gt;
&lt;h3&gt;楽天&lt;/h3&gt;
&lt;p&gt;そもそも学生でなくても15~25歳まで対象なので、Rakuten学割の対象ではあったが、楽天ネットスーパー、楽天モバイル、楽天ひかり（光回線）くらいしか利用していないため、恩恵を受けることはない。&lt;br&gt;
一応登録しておいたが、&lt;strong&gt;楽天学割メルマガ購読&lt;/strong&gt;が必須条件だったので笑った。&lt;/p&gt;
&lt;p class=&apos;diamond&apos;&gt;&amp;#9830;&lt;/p&gt;
&lt;h3&gt;Apple Pencil（第1世代）を学割で購入&lt;/h3&gt;
&lt;p&gt;2年半ほど前に行われたPayPay20%還元祭りの際に購入したiPadを所持していたので、学生になったことだしApple Pencilを購入。&lt;br&gt;
想像以上に書き心地が良いので、購入してよかった。&lt;br&gt;
Apple公式ストアの学割+楽天Rebates（楽天の学割について調べているときに発見した）を利用して購入した。&lt;br&gt;
メモ書き用に溜めていた裏紙を処分できたので机の上がすっきりした。  &lt;/p&gt;
&lt;h4&gt;所感&lt;/h4&gt;
&lt;p&gt;ブログをはじめて今回で4投稿目だが、書き上げるのにとても時間がかかっている。&lt;br&gt;
（この投稿は書き始めてから、3週間弱放置していた。）&lt;br&gt;
別に仕事でやっているわけではないのでいいのだけれど、もう少し思い通りにすらすら書きたいとは思う。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[初めてnpmパッケージを作って公開した]]></title><description><![CDATA[作ったもの gatsbyの新規記事テンプレートを生成するcliツール 目標 でインストールし、 のように利用できるようにする。   インストールするだけでcliから利用可能にしたい 前回の記事ではのにコマンド名とスクリプトのパスを設定することでcli…]]></description><link>https://eginoy.github.io/blog/初めてnpmパッケージを公開した/</link><guid isPermaLink="false">https://eginoy.github.io/blog/初めてnpmパッケージを公開した/</guid><pubDate>Wed, 31 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;作ったもの&lt;/h2&gt;
&lt;p&gt;gatsbyの新規記事テンプレートを生成する&lt;a href=&quot;https://github.com/eginoy/gatsby_new_post_script&quot;&gt;cliツール&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;目標&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ yarn add --dev gatsby-new-post-generator&lt;/code&gt;でインストールし、&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ yarn newpost ${blogTitle}&lt;/code&gt;のように利用できるようにする。  &lt;/p&gt;
&lt;h2&gt;インストールするだけでcliから利用可能にしたい&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://eginoy.github.io/%E6%96%B0%E8%A6%8F%E8%A8%98%E4%BA%8B%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E6%9B%B8%E3%81%84%E3%81%9F/&quot;&gt;前回の記事&lt;/a&gt;では&lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;の&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;にコマンド名とスクリプトのパスを設定することでcliから利用することができた。&lt;br&gt;
今回はnpmパッケージとして扱いたいので、package.jsonを作成する。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ npm init&lt;/code&gt;&lt;br&gt;
パッケージ名やその他諸々の情報を含んだpackage.jsonが生成される。  &lt;/p&gt;
&lt;p&gt;npmリポジトリからインストール後、追加設定(package.jsonのscriptへ追記)を行うことなくcliから利用できるようにしたい。&lt;br&gt;
そのため、以下のようにpackage.jsonを変更した。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gatsby-new-post-generator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Generate gatsby new post(.md) cli script&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./lib/newpost.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;bin&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;newpost&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bin/index.js&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;repository&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;git&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;git+ssh://git@github.com/eginoy/gatsby-new-post-generator.git&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;eginoy&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;MIT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;bugs&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://github.com/eginoy/gatsby-new-post-generator/issues&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;homepage&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://github.com/eginoy/gatsby-new-post-generator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;keywords&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;gatsby-new-post&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;directories&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;lib&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;lib&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;bin&lt;/code&gt;の設定がポイントで、&lt;code class=&quot;language-text&quot;&gt;bin&lt;/code&gt;に設定した&lt;code class=&quot;language-text&quot;&gt;newpost&lt;/code&gt;がcliから呼び出す際のスクリプト名称になっている。&lt;br&gt;
処理は&lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;で指定している&lt;code class=&quot;language-text&quot;&gt;./lib/newpost.js&lt;/code&gt;に記述している。  &lt;/p&gt;
&lt;h3&gt;ローカルで動作確認&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;yarn add&lt;/code&gt;コマンドの引数にファイルパスを渡すと、ローカルのパッケージを追加することが可能。&lt;br&gt;
そのため、npmjsリポジトリへ公開する前にローカルで動作確認を行うことができる。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ cd ${gatsby_blog_directory}&lt;/code&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ yarn add --dev ../gatsby-new-post-generator&lt;/code&gt;  &lt;/p&gt;
&lt;h3&gt;動作確認&lt;/h3&gt;
&lt;p&gt;newpostでの記事生成前&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ tree content/blog/
content/blog/
├── Gatsbyでブログを作った
│   └── index.md
├── Ubuntu20.04でVisualStudioCodeがクラッシュする
│   └── index.md
├── 初めてnpmパッケージを公開した
│   └── index.md
└── 新規記事を作成するスクリプトを書いた
    └── index.md&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下のコマンドで新しい投稿を生成&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ yarn newpost HelloWorld!&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ tree content/blog/
content/blog/
├── Gatsbyでブログを作った
│   └── index.md
├── HelloWorld! //newpostコマンドで生成
│   └── index.md
├── Ubuntu20.04でVisualStudioCodeがクラッシュする
│   └── index.md
├── 初めてnpmパッケージを公開した
│   └── index.md
└── 新規記事を作成するスクリプトを書いた
    └── index.md&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;公開手順&lt;/h2&gt;
&lt;h3&gt;npmjsのアカウントを作成する&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.npmjs.com/signup&quot;&gt;ここ&lt;/a&gt;からサインアップする&lt;br&gt;
自分はnpmjs用のメールアドレスを新しく作成した。(スパムメール対策)  &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ npm login&lt;/code&gt;でログインする&lt;/p&gt;
&lt;h3&gt;公開する&lt;/h3&gt;
&lt;p&gt;公開したいパッケージのディレクトリへ移動する&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ cd ${npm_package_dir}&lt;/code&gt;&lt;br&gt;
npmリポジトリへ公開&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ npm publish&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;学べたこと&lt;/h2&gt;
&lt;p&gt;npmとyarnはパッケージをインストールしたときの挙動が微妙に違うことがわかった。&lt;br&gt;
今回のようにcli-toolとして利用したいとき、&lt;br&gt;
yarnを利用すると、&lt;code class=&quot;language-text&quot;&gt;--dev&lt;/code&gt;オプションを利用した場合でも&lt;code class=&quot;language-text&quot;&gt;yarn newpost&lt;/code&gt;のように利用できた。(開発関係依存として追加したプロジェクト内でスコープを限定できる)&lt;br&gt;
しかし、npmの&lt;code class=&quot;language-text&quot;&gt;--save-dev&lt;/code&gt;オプションで開発依存関係としてパッケージをインストールすると&lt;code class=&quot;language-text&quot;&gt;npm run newpost&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;npm newpost&lt;/code&gt;のように利用することができなかった。&lt;br&gt;
(グローバルインストール(&lt;code class=&quot;language-text&quot;&gt;-g&lt;/code&gt;オプション)すれば、bash aliasのように&lt;code class=&quot;language-text&quot;&gt;newpost&lt;/code&gt;で使用できるが、gatsbyの記事生成で利用するだけなので適当でない)&lt;/p&gt;
&lt;h2&gt;所感&lt;/h2&gt;
&lt;p&gt;npmパッケージはインストールして利用するだけで、作成するのは今回が初めてだった。&lt;br&gt;
そもそもこのような形でまとめるのも初めてで、とても大変だった。&lt;br&gt;
しかし、やってみると今まで曖昧にしてきた部分を調べ直したりしたので、良い学習になった。
また、意外と手軽にnpmパッケージを作ることができることがわかり、良い経験になった。&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nodachisoft.com/common/jp/article/jp000110/&quot;&gt;https://nodachisoft.com/common/jp/article/jp000110/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.npmjs.org/post/118810260230/building-a-simple-command-line-tool-with-npm&quot;&gt;https://blog.npmjs.org/post/118810260230/building-a-simple-command-line-tool-with-npm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://qiita.com/suzuki_sh/items/f3349efbfe1bdfc0c634&quot;&gt;https://qiita.com/suzuki_sh/items/f3349efbfe1bdfc0c634&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/jspoint/creating-cli-executable-global-npm-module-5ef734febe32&quot;&gt;https://medium.com/jspoint/creating-cli-executable-global-npm-module-5ef734febe32&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://note.kiriukun.com/entry/20190417-path-resolve&quot;&gt;https://note.kiriukun.com/entry/20190417-path-resolve&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[新規記事を作成するスクリプトを書いた]]></title><description><![CDATA[つくったもの https://github.com/eginoy/gatsby-new-post-generator インストール gatsbyで作成したwebsiteディレクトリに移動し、script格納ディレクトリを作成して移動    リポジトリ全体は必要無いのでsvn…]]></description><link>https://eginoy.github.io/blog/新規記事を作成するスクリプトを書いた/</link><guid isPermaLink="false">https://eginoy.github.io/blog/新規記事を作成するスクリプトを書いた/</guid><pubDate>Mon, 22 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;つくったもの&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/eginoy/gatsby-new-post-generator&quot;&gt;https://github.com/eginoy/gatsby-new-post-generator&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;インストール&lt;/h2&gt;
&lt;p&gt;gatsbyで作成したwebsiteディレクトリに移動し、script格納ディレクトリを作成して移動&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ cd ${your_gatsby_website_dir} &amp;amp;&amp;amp; mkdir script &amp;amp;&amp;amp; cd script&lt;/code&gt;  &lt;/p&gt;
&lt;p&gt;リポジトリ全体は必要無いのでsvnコマンドでscriptを落としてくる&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;$ svn export https://github.com/eginoy/gatsby-new-post-generator/trunk/lib/&lt;/code&gt;&lt;br&gt;
&lt;del&gt;（TODO: せっかくなのでnpmパッケージとして使えるようにする。）&lt;/del&gt;&lt;br&gt;
&lt;a href=&quot;https://eginoy.github.io/%E5%88%9D%E3%82%81%E3%81%A6npm%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E5%85%AC%E9%96%8B%E3%81%97%E3%81%9F/&quot;&gt;npmパッケージにした。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;package.jsonのscriptsにnewpostコマンドを追加する&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;&amp;quot;scripts&amp;quot;: { &amp;quot;newpost&amp;quot;: &amp;quot;node ./script/lib/newpost.js&amp;quot;, &amp;quot;build&amp;quot;: &amp;quot;gatsby build&amp;quot;, ...&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;使い方&lt;/h2&gt;
&lt;p&gt;hello_worldというタイトルの記事を作成する。&lt;br&gt;
（Markdownのメタデータへ指定したタイトル,本日日付をセットした雛形を生成）  &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ yarn newpost hello_world&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;なぜつくったか&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;以前少し触ったGo製の静的サイトジェネレーター(hugo)には新しいページを作成するコマンドがあったがGatsbyにはなかったので。  &lt;/li&gt;
&lt;li&gt;毎回手動で記事を作成するのが面倒。  &lt;/li&gt;
&lt;li&gt;cliツールを作成してみたいと思っていたところに、良い感じの課題が生えてきたので。  &lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;所感&lt;/h2&gt;
&lt;p&gt;cliツールを作るのは初めてだったが、面倒な作業を自動化できて楽しかった。&lt;br&gt;
（この記事はスクリプトから生成した雛形から作成した。）&lt;br&gt;
npmにパッケージを公開した経験も無いので、svnコマンドを使用したインストールになっている箇所を、npmでインストールできるようにしたい。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ubuntu20.04でVisual Studio Codeがクラッシュする]]></title><description><![CDATA[経緯 WSL2上のUbuntu20.04を使用して開発していたが、ローカルで立てた開発サーバー(localhost)にアクセスできないといった現象が定期的に発生していた。 根本的な解決ができず、ストレスが貯まるのでDualBootでUbuntu20.0…]]></description><link>https://eginoy.github.io/blog/Ubuntu20.04でVisualStudioCodeがクラッシュする/</link><guid isPermaLink="false">https://eginoy.github.io/blog/Ubuntu20.04でVisualStudioCodeがクラッシュする/</guid><pubDate>Sun, 21 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;経緯&lt;/h3&gt;
&lt;p&gt;WSL2上のUbuntu20.04を使用して開発していたが、ローカルで立てた開発サーバー(localhost)にアクセスできないといった現象が定期的に発生していた。&lt;br&gt;
根本的な解決ができず、ストレスが貯まるのでDualBootでUbuntu20.04をインストールし、開発環境構築のためVisual Studio Code(以下vscode)を公式からインストールしたところ､起動後にクラッシュしてしまう現象に遭遇し､3時間ほど溶かしてしまったのでワークアラウンドをメモ｡  &lt;/p&gt;
&lt;h3&gt;環境&lt;/h3&gt;
&lt;p&gt;DISTRIB&lt;em&gt;ID=Ubuntu&lt;br&gt;
DISTRIB&lt;/em&gt;RELEASE=20.04&lt;br&gt;
DISTRIB&lt;em&gt;CODENAME=focal&lt;br&gt;
DISTRIB&lt;/em&gt;DESCRIPTION=“Ubuntu 20.04.2 LTS”&lt;br&gt;
Visual Studio Code version = 1.54.3&lt;/p&gt;
&lt;h3&gt;解決手順&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sudo snap remove code&lt;/code&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;sudo apt purge code&lt;/code&gt;&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;rm ~/.local/share/keyrings -fr&lt;/code&gt;  &lt;/p&gt;
&lt;h4&gt;再度vscodeをインストールする｡&lt;/h4&gt;
&lt;p&gt;snapからインストールすると日本語入力ができないので､公式からダウンロードしてきてインストールする｡&lt;br&gt;
&lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;公式&lt;/a&gt;から&lt;code class=&quot;language-text&quot;&gt;.deb&lt;/code&gt;ファイルをインストールしてくる｡&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;sudo apt install ./code_1.54.3-1615806378_amd64.deb&lt;/code&gt; //ファイル名は適宜読み替えること  &lt;/p&gt;
&lt;h3&gt;解決方法の補足&lt;/h3&gt;
&lt;p&gt;参考リンクへ貼ったIssueに再現手順が書かれているが､自身の環境では以下の流れで今回の問題が発生した｡&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;snapでvscodeをインストール  &lt;/li&gt;
&lt;li&gt;GitHubアカウントでログインし設定を同期  &lt;/li&gt;
&lt;li&gt;snap経由でインストールしたvscodeでは日本語入力をできないことがわかりアンインストールする  &lt;/li&gt;
&lt;li&gt;公式の&lt;code class=&quot;language-text&quot;&gt;.deb&lt;/code&gt;を使用して再度vscodeをインストール &lt;/li&gt;
&lt;li&gt;vscodeが起動後にすぐクラッシュしてしまう  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;gnome keyringが持っているGitHubの認証情報がおかしなことになる（異なるバージョンのvscodeが読み書きすることで破壊している？）ことでクラッシュしているようなので､以下のコマンドでkeyringsをクリアすることで解決したと思っている｡&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;rm ~/.local/share/keyrings -fr&lt;/code&gt;  &lt;/p&gt;
&lt;h3&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/microsoft/vscode/issues/116690#issuecomment-791064392&quot;&gt;https://github.com/microsoft/vscode/issues/116690#issuecomment-791064392&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://askubuntu.com/questions/78344/how-to-completely-reset-erase-the-keyring&quot;&gt;https://askubuntu.com/questions/78344/how-to-completely-reset-erase-the-keyring&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Gatsbyでブログを作った]]></title><description><![CDATA[なぜGatsby ブログサービスを使用するのに比べ、良い学習になると思った 必然的にWeb周りの知識が必要になり、楽しみながら学習できる良い機会だと考えたので、ブログサービスを使用するのではなく、静的サイトジェネレーターでのブログ作成を選択した。   React.js…]]></description><link>https://eginoy.github.io/blog/Gatsbyでブログを作った/</link><guid isPermaLink="false">https://eginoy.github.io/blog/Gatsbyでブログを作った/</guid><pubDate>Fri, 19 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;なぜGatsby&lt;/h2&gt;
&lt;h3&gt;ブログサービスを使用するのに比べ、良い学習になると思った&lt;/h3&gt;
&lt;p&gt;必然的にWeb周りの知識が必要になり、楽しみながら学習できる良い機会だと考えたので、ブログサービスを使用するのではなく、静的サイトジェネレーターでのブログ作成を選択した。  &lt;/p&gt;
&lt;h3&gt;React.js + TypeScript + GraphQL（よくわからない）の組み合わせが気に入った&lt;/h3&gt;
&lt;p&gt;仲間内で使うWebアプリをReact.js + TypeScript + Firebaseの組み合わせで開発しており、この組み合わせに近かったのでGatsbyを選択した。&lt;br&gt;
GraphQLについては名前を聞いたことがある程度なので、これを機に調べてみようと思う。  &lt;/p&gt;
&lt;h3&gt;モダンなフロントエンドライブラリに触れる機会を増やしたい&lt;/h3&gt;
&lt;p&gt;現職では、業務系WebアプリをASP.NET + Knockout.jsの組み合わせで開発している。&lt;br&gt;
ゆくゆくは帰郷したいので、そのためには転職する必要がある。&lt;br&gt;
（COVID-19の影響でリモートワークになって1年経つが、元々客先常駐の受託開発なので関東圏外での就業不可）&lt;br&gt;
いわゆるWeb系の求人を眺めていると、フロントエンドライブラリはReact.js、Vue.jsどちらか扱える必要があると感じたので。&lt;br&gt;
（サーバーサイドはRailsも触らなければ）&lt;/p&gt;
&lt;h3&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://takumon.com/2018/09/10/&quot;&gt;https://takumon.com/2018/09/10/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>